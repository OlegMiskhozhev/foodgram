# Проект Foodgram

«Фудграм» — сайт, на котором пользователи может публиковать свои рецепты,
добавлять чужие рецепты в избранное и подписываться на публикации других авторов.
Зарегистрированным пользователям также доступен сервис «Список покупок».
Он позволит создавать список продуктов, которые нужно купить для приготовления
выбранных блюд.

Доступен по адресу: [https://foodgramer.sytes.net/](https://foodgramer.sytes.net/)

## Описание проекта

### Главная
Содержимое главной — список первых шести рецептов, отсортированных по дате
публикации «от новых к старым». На этой странице подразумевается постраничная
пагинация. Остальные рецепты должны быть доступны на следующих страницах.

### Страница регистрации
В проекте доступна система регистрации и аутентификации пользователей. 
Обязательные поля для пользователя при регистрации:
* имя,
* фамилия,
* имя пользователя (никнейм),
* адрес электронной почты,
* пароль.

### Страница входа
После регистрации пользователь переадресовывается на страницу входа.

### Страница рецепта
Здесь — полное описание рецепта. Залогиненные пользователи могут добавить рецепт
в избранное и список покупок, а также подписаться на автора рецепта.

### Страница пользователя
На странице — имя пользователя, все рецепты, опубликованные пользователем,
и кнопка, чтобы подписаться или отписаться от него.

### Страница подписок
Только владелец аккаунта может просмотреть свою страницу подписок.
Ссылка на неё находится в выпадающем меню в правом верхнем углу.
Подписаться на публикации могут только залогиненные пользователи.
Сценарий поведения пользователя:
Пользователь переходит на страницу другого пользователя или на страницу рецепта
и подписывается на публикации автора кликом по кнопке Подписаться на автора.
Пользователь переходит на страницу Мои подписки и просматривает список рецептов,
опубликованных теми авторами, на которых он подписался. Записи сортируются по
дате публикации — от новых к старым.
При необходимости пользователь может отказаться от подписки на автора.
Тогда ему нужно перейти на страницу автора, его рецепта или на страницу своих
подписок и нажать кнопку Отписаться.

### Избранное
Добавлять рецепты в избранное может только залогиненный пользователь.
Если незалогиненный пользователь попробует добавить рецепт в избранное,
подписки или покупки, то приложение попросит его зарегистрироваться или войти в
свой аккаунт
Добавить рецепт в избранное можно с главной страницы и со страницы самого рецепта,
нажав на соответствующую иконку.
Сам список избранного может просмотреть только его владелец.
Сценарий поведения пользователя:
Пользователь отмечает один или несколько рецептов кликом по кнопке
Добавить в избранное.
Пользователь переходит на страницу Избранное и просматривает свой список
избранных рецептов.
При необходимости пользователь может удалить рецепт из избранного.

### Список покупок
Работать со списком покупок могут только залогиненные пользователи.
Доступ к собственному списку покупок есть только у владельца аккаунта.
Сценарий поведения пользователя:
Пользователь отмечает один или несколько рецептов кликом по кнопке Добавить в покупки.
Сделать это можно с главной страницы или со страницы рецепта.
Пользователь переходит на страницу Список покупок, там доступны все добавленные
в список рецепты. Пользователь нажимает кнопку Скачать список и получает файл
с перечнем и количеством необходимых ингредиентов для всех рецептов,
сохранённых на странице Список покупок.
При необходимости пользователь может удалить рецепт из списка покупок.
Пользователь может скачать свой список покупок в текстовом формате.

### Создание и редактирование рецепта
Эта страница доступна только для залогиненных пользователей.
Все поля на ней обязательны для заполнения. 
Сценарий поведения пользователя:
Пользователь переходит на страницу добавления рецепта,
нажав на кнопку Создать рецепт в шапке сайта.
Пользователь заполняет все обязательные поля.
Пользователь нажимает кнопку Создать рецепт.
Также пользователь может отредактировать любой рецепт, который он создал.

### Страница изменения пароля
Доступ к этой странице есть только у залогиненных пользователей,
через кнопку Сменить пароль в выпадающем меню в правом верхнем углу страницы.

### Фильтрация по тегам
Тег (от англ. tag, «метка», «бирка», «ярлык») — метка, которая классифицирует
данные и помогает облегчить процесс поиска нужной информации в веб-приложении.
При добавлении рецепта обязательно указывается один или несколько тегов.
Новые теги может добавить только администратор сайта.
На страницах с рецептами при нажатии на название тега выводится список рецептов,
отмеченных этим тегом. Фильтрация может проводиться по нескольким тегам
в комбинации «или»: если выбрано несколько тегов, в результате должны быть
показаны рецепты, которые отмечены хотя бы одним из этих тегов.
При фильтрации на странице пользователя фильтруются только рецепты выбранного
пользователя. Такой же принцип должен соблюдаться при фильтрации списка избранного.

### Смена аватара
После регистрации новый пользователь получает изображение профиля по умолчанию.
При клике на аватар у пользователя в шапке сайта появляется возможность
поменять его или удалить.

## Стек технологий

* [Python 3.9+](https://www.python.org)
* [Django 3.2.16](https://www.djangoproject.com)
* [djangorestframework 3.12.4](https://www.django-rest-framework.org)
* [django_filter 23.1](https://django-filter.readthedocs.io/en/stable/)
* [djoser 2.1.0](https://djoser.readthedocs.io/en/latest/index.html#)
* [Pillow==9.0.0](https://pillow.readthedocs.io/en/stable/index.html)
* [python-dotenv==1.0.1](https://pypi.org/project/python-dotenv/)
* [flake8==6.0.0](https://pypi.org/project/flake8/)
* [flake8-isort==6.0.0](https://pypi.org/project/flake8-isort/)
* [gunicorn 20.1.0](https://docs.gunicorn.org/en/stable/)
* [psycopg2-binary==2.9.3](https://www.psycopg.org/docs/module.html)
* [postgresql-17.5](https://postgrespro.ru/docs/postgresql/current/release-17-5)
* [Docker](https://docs.docker.com)


## Развертывание проекта

### Тспользование Continuous Integration (CI) и Continuous Deployment (CD)

#### Подготовка сервера

Войти на сервер с использованием SSH-ключа, имени пользователя и passphrase:
```console
ssh -i путь_до_файла_с_SSH_ключом/название_файла_закрытого_SSH-ключа login@ip

# Например:
# ssh -i D:/Dev/vm_access/yc-yakovlevstepan yc-user@153.0.2.10
```

Установить Docker:
```console
sudo apt update
sudo apt install curl
curl -fSL https://get.docker.com -o get-docker.sh
sudo sh ./get-docker.sh
sudo apt install docker-compose-plugin
```

Создать папку проекта, в ней создать файл .env для хранения закрытой информации
(ключи, имена пользователей, пароли):
```console
sudo mkdir foodgram
sudo touch foodgram/.env
```

Открыть файл .env в редакторе nano:
```console
sudo nano foodgram/.env
```

Записать в файл данные по примеру ниже, сохранить данные (Ctrl S),
выйти из редактора (Ctrl X):
```console
SECRET_KEY=some_key                 #Укажите свой ключ для шифрования в Django
DEBUG=True                          #Укажите True/False для режима отладки/обычного режима
ALLOWED_HOSTS=localhost,127.0.0.1   #Допишите в список ip сервера и имя хоста
POSTGRES_DB=databasename            #Название для базы данных
POSTGRES_USER=databaseuser          #Имя поьзователя базы данных
POSTGRES_PASSWORD=password          #Пароль доступа базы данных
DB_HOST=db                          #Хост для доступа Django к базе данных
DB_PORT=5432                        #Порт для доступа Django к базе данных
```

#### Подготовка репозитория

Склонировать проект из репозитория:
```console
git clone https://github.com/OlegMiskhozhev/foodgram.git
```

В разделе репозитория GitHub Actions ```Settings/Secrets/Actions``` прописать Secrets -
переменные окружения для доступа к сервисам:

```
SECRET_KEY='<secret_key>'  # стандартный ключ, который создается при старте проекта,
                           # ключ должен быть заключен в '...'
DEBUG=False                # опция отладчика True/False
ALLOWED_HOSTS              # список хостов/доменов, для которых дотсупен текущий проект
                           # изменить IP-адрес сервера и/или добавить имя хоста

DB_NAME                    # имя БД - postgres (по умолчанию)
POSTGRES_USER              # логин для подключения к БД - postgres (по умолчанию)
POSTGRES_PASSWORD          # пароль для подключения к БД (установите свой)
DB_HOST=db                 # название сервиса (контейнера)
DB_PORT=5432               # порт для подключения к БД

DOCKER_USERNAME            # имя пользователя в DockerHub
DOCKER_PASSWORD            # пароль пользователя в DockerHub

HOST                       # ip_address сервера
USER                       # имя пользователя
SSH_KEY                    # приватный ssh-ключ локального ПК имеющего доступ к серверу (cat ~/.ssh/id_rsa)
                           # ключ вводится полностью, начиная с -----BEGIN OPENSSH PRIVATE KEY-----
                           # до -----END OPENSSH PRIVATE KEY-----
PASSPHRASE                 # кодовая фраза (пароль) для ssh-ключа

TELEGRAM_TO                # id телеграм-аккаунта (можно узнать у @userinfobot, команда /start)
TELEGRAM_TOKEN             # токен бота (получить токен можно у @BotFather, /token, имя бота)
```

При push автоматически отрабатывают сценарии:
* *tests* - проверка кода на соответствие стандарту PEP8 и тесты backend;
* *build_and_push_to_docker_hub* - сборка и доставка докер-образов на DockerHub;
Дальнейшие шаги выполняются только если push был в ветку main;
* *deploy* - автоматический деплой проекта на боевой сервер. Выполняется
копирование файлов из DockerHub на сервер и запуск проекта через Docker;
* *send_message* - отправка уведомления в Telegram.


### Локальное развертывание проекта:

Склонировать проект из репозитория:
```console
git clone https://github.com/OlegMiskhozhev/foodgram.git
```

Перейти в папку backend проекта, создайть и активировать вирутальное окружение:
```console
cd foodgram
```

Создать файл .env для хранения закрытой информации (ключи, имена пользователей, пароли):
```console
touch .evn
```

Открыть файл .env и указать нем данные по следующему примеру:
```
SECRET_KEY=some_key                 #Укажите свой ключ для шифрования в Django
DEBUG=True                          #Укажите True/False для режима отладки/обычного режима
ALLOWED_HOSTS=localhost,127.0.0.1
POSTGRES_DB=databasename            #Название для базы данных
POSTGRES_USER=databaseuser          #Имя поьзователя базы данных
POSTGRES_PASSWORD=password          #Пароль доступа базы данных
DB_HOST=db                          #Хост для доступа Django к базе данных
DB_PORT=5432                        #Порт для доступа Django к базе данных
```

Выполнить сборку образов и запуск контейнеров в Докере:
```console
docker-compose up
```

Выполнить миграции, создать суперпользователя:
```console
docker exec foodgran-backend python manage.py migrate
docker exec foodgran-backend python manage.py createsuperuser
```

Собрать файлы статики и скопировать их в паку, связанную с volume:
```console
docker exec foodgram-backend python manage.py collectstatic
docker exec foodgram-backend cp -r /app/collected_static/. /backend_static/static/
```

Проект доступен по адресу http://localhost:8800

### Локальное развертывание проекта для работы с бэкендом:

Склонировать проект из репозитория:
```console
git clone https://github.com/OlegMiskhozhev/foodgram.git
```

Перейти в папку backend проекта, создайть и активировать вирутальное окружение:
```console
cd foodgram/backend
python -m venv venv
source venv/bin/activate  #Для Linux и MacOS
source venv/Scripts/activate  #Для Windows
```

Установить зависимости:
```console
python -m pip install --upgrade pip
pip install -r requiremts.txt
```

Создать файл .env для хранения закрытой информации (ключи, имена пользователей, пароли):
```console
touch .evn
```

Открыть файл .env и указать нем следующие данные:
```console
SECRET_KEY=some_key                 #Укажите свой ключ для шифрования в Django
DEBUG=True                          #Укажите True/False для режима отладки/обычного режима
ALLOWED_HOSTS=localhost,127.0.0.1
```

Для локального запуска можно использовать базу данных sqlite3.
Для этого измените код в файле: foodgram/backend/backend/settings.py:
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

Находясь в папке foodgram/backend выполнить миграции, создайть суперпользователя:
```console
python manage.py migrate
python manage.py createsuperuser
```

Запустить локальный сервер:
```console
python manage.py runserver
```

Сервис API будет доступен по адресу http://127.0.0.1:8000/api/

Документация API сервиса будет доступна по адресу http://127.0.0.1:8000/redoc/

## Авторы
[OlegMiskhozhev](https://github.com/OlegMiskhozhev) - бэкенд и CI/CD для Foodgram;
[Яндекс.Практикум](https://github.com/yandex-praktikum) - фронтенд
для Foodgram.